<!DOCTYPE html>
<html>
  <head>
    <title>Dnimesol</title>
    <meta name="Dnimesol JS13KGames" content="A-Frame game">
    <script src="https://aframe.io/releases/0.6.0/aframe.min.js"></script>  
    <!-- <script src="components.js"></script>    -->
    <script type='text/javascript'>AFRAME.registerComponent('scale-on-mouseenter', {
      schema: {
        to: {default: '2.5 2.5 2.5'}
      },
      init: function () {
        var data = this.data;
        this.el.addEventListener('mouseenter', function () {
          this.setAttribute('scale', data.to);
        });
      }
    });
  
    AFRAME.registerComponent('scale-on-mouseleave', {
      schema: {
        to: {default: '1 1 1'}
      },
      init: function () {
        var data = this.data;
        this.el.addEventListener('mouseleave', function () {
          this.setAttribute('scale', data.to);
        });
      }
    });
  
  
    AFRAME.registerComponent('move-to', {
      schema: {
        to: {default: '2.5 2.5 2.5'}
      },
      init: function () {
        var data = this.data;
        this.el.addEventListener('mouseenter', function () {
          this.setAttribute('scale', data.to);
        });
      }
    });
  
  AFRAME.registerComponent('cursor-listener', {
    init: function () {
      var COLORS = ['red', 'green', 'blue'];
      this.el.addEventListener('click', function (evt) {
        var randomIndex = Math.floor(Math.random() * COLORS.length);
        this.setAttribute('material', 'color', COLORS[randomIndex]);
        console.log('I was clicked at: ', evt.detail.intersection.point);
      });
    }
  });
  
  AFRAME.registerComponent('select-on-fuse', {
      schema: {
        to: {default: '2.5 2.5 2.5'}
      },
      init: function () {
        var data = this.data;
        this.el.addEventListener('click', function () {
          this.setAttribute('rotation', data.to);
        });
      }
    });
  
  
  AFRAME.registerComponent('follow', {
    schema: {speed: {default: '2'}},
  
    init: function () {
  
   
    },
     update: function () {
  
    },
  
    tick: function (time, timeDelta) {
      var progress = this.el.getAttribute('position');
      var toX = progress.x-0.01;
      var toY = progress.y;
      var toZ = progress.z+0.01;
      // console.log(progress);
      this.el.setAttribute('position', {x: toX, y: toY, z: toZ});
      // console.log(this.el.getAttribute('position').x);
    }
  });
  
  
  AFRAME.registerComponent('rotate', {
    schema: {speed: {default: '2'}},
  
    init: function () {
  
   
    },
     update: function () {
  
    },
  
    tick: function (time, timeDelta) {
      var progress = this.el.getAttribute('rotation');
      var toX = progress.x;
      var toY = progress.y + 1;
      var toZ = progress.z;
      // console.log(progress);
      this.el.setAttribute('rotation', {x: toX, y: toY, z: toZ});
    }
  });
  
  
  AFRAME.registerComponent('pump', {
    schema: {speed: {default: '2'}},
  
    init: function () {
  
   
    },
     update: function () {
  
    },
  
    tick: function (time, timeDelta) {
      var progress = this.el.getAttribute('position');
      var toX = progress.x;
      var toY = progress.y;
      var toZ = progress.z;
      // console.log(progress);
      this.el.setAttribute('position', {x: toX, y: toY, z: toZ});
    }
  });
  
  var back = false;
  var reverse = false;
  AFRAME.registerComponent('follow-circle', {
  
    schema: {
      rootA: {default: '0'},
      rootB: {default: '0'},
      rootRadius: {default: '3'},
      speed: {default: '0.01'}
  },
  
    init: function () {
      var pos = this.el.getAttribute('position');
      var initX = this.data.rootA - this.data.rootRadius;
      var initY = this.data.rootB;
      var initZ = pos.z;
      this.el.setAttribute('position', {x: initX, y: initY, z: initZ});
    },
     update: function () {
  
    },
  
    tick: function (time, timeDelta) {
      var progress = this.el.getAttribute('position');
      var toX;
      var toY;
      var toZ = progress.z;
      
      // console.log(progress.x);
      // console.log(this.data.rootA);
      if( Math.abs((this.data.rootA + this.data.rootRadius) - progress.x) < 0.001 ){
        back = false;
        reverse = false;
      }
  
      if(Math.abs(progress.x - (this.data.rootA - this.data.rootRadius))<0.001){
        back = true;
        reverse = false;
      }
      if(Math.abs(this.data.rootA - progress.x)<0.001){
        reverse = true;
      }
  
      if(back){
        toX = progress.x - this.data.speed;
      }
      else {
        toX = progress.x + this.data.speed;
      }
  
      if(reverse){
        toY = this.data.rootB + Math.sqrt(Math.pow(this.data.rootRadius,2) - Math.pow((toX-this.data.rootA),2));
      } 
      else {
        toY = this.data.rootB - Math.sqrt(Math.pow(this.data.rootRadius,2) - Math.pow((toX-this.data.rootA),2));
      }
        
      this.el.setAttribute('position', {x: toX, y: toY, z: toZ});
      // console.log(reverse);
      // console.log(back);
  
    }
  });
  
   AFRAME.registerComponent('random-torus-knot', {
          init: function () {
            this.el.setAttribute('geometry', {
              primitive: 'torusKnot',
              radius: Math.random() * 10,
              radiusTubular: Math.random() * .75,
              p: Math.round(Math.random() * 10),
              q: Math.round(Math.random() * 10)
            });
          }
        });
  
  
        function nextScene() {
          console.log("next")
      document.getElementById('scene1').setAttribute('visible', 'false');
      document.getElementById('scene2').setAttribute('visible', 'true');
      document.querySelector("a-sky").setAttribute('color','black');
    };
  
  
  
  
  
  
    /////////////////////////////////////////////// GamePlay
   </script>


  </head>
  <body>
    <a-scene>
        <a-assets>
          <a-mixin id="cube" geometry="primitive: box"></a-mixin>
          <a-mixin id="cube-hovered" material="color: magenta"></a-mixin>
          <a-mixin id="cube-selected" material="color: cyan"></a-mixin>
          <a-mixin id="red" material="color: red"></a-mixin>
          <a-mixin id="pinky" material="color: green"></a-mixin>
          <a-mixin id="green" material="color: green"></a-mixin>
          <a-mixin id="blue" material="color: blue"></a-mixin>
          <a-mixin id="yellow" material="color: yellow"></a-mixin>
          <a-mixin id="sphere" geometry="primitive: sphere"></a-mixin>
        </a-assets>

        <!--<a-entity position="0 2.2 4">
          <a-entity camera="active:false" look-controls wasd-controls>
            <a-entity position="0 0 -1"
                      geometry="primitive: ring; radiusOuter: 0.016; radiusInner: 0.01;"
                      material="color:cyan; opacity:0.6; shader: flat"
                      cursor="maxDistance: 1000; fuse: true; fuseTimeout: 1700">
                <a-animation begin="click" easing="ease-in" attribute="scale"
                  fill="backwards" from="0.2 0.2 0.2" to="1 1 1" dur="150"></a-animation>
                <a-animation begin="fusing" easing="ease-in" attribute="material.color"
                  fill="backwards" from="#fa47bf" to="magenta" dur="1700"></a-animation>
                <a-animation begin="fusing" easing="ease-in" attribute="scale"
                  fill="backwards" from="1 1 1" to="0.2 0.2 0.2" dur="1700"></a-animation>
            </a-entity>
          </a-entity>
        </a-entity>-->
         <!--<a-cursor color="#f2b3e1" fuse=true fusetimeout=2000> </a-cursor>   -->

    

          
          
        <a-sky color="#b9ffef"></a-sky>


        <a-entity id="scene2" visible="true" startGame>
          <a-entity id="gameCamera" position="0 3 10">
          <a-entity camera="active:true" look-controls wasd-controls>
              <a-entity id="score" position="0 -15 -20" scale="5.021 4.475 1" text="value:;color:#018b88;align:center;height:25;varterSpacing:3;width:7" geometry="primitive:plane" material="opacity:0;color:#a49a1e"></a-entity>                         
            <a-entity position="0 0 -1"
                      geometry="primitive: ring; radiusOuter: 0.016; radiusInner: 0.01;"
                      material="color:#708e8a; opacity:0.6; shader: flat"
                      cursor="max-distance:20; fuse: true; fuseTimeout: 1700">
                <!-- <a-animation begin="click" easing="ease-in" attribute="scale"
                  fill="backwards" from="0.2 0.2 0.2" to="1 1 1" dur="150"></a-animation> -->
                <!-- <a-animation begin="fusing" easing="ease-in" attribute="material.color"
                  fill="backwards" from="#fa47bf" to="magenta" dur="1700"></a-animation> -->
                <a-animation begin="fusing" easing="ease-in" attribute="scale"
                  fill="backwards" from="1 1 1" to="0.2 0.2 0.2" dur="1700"></a-animation>
            </a-entity>
          </a-entity>
        </a-entity>

        <a-entity id="portal" position="0 0 -200" scale="9.715 8.691 6.896" geometry="radiusTubular:0.1;primitive:torus" material="metalness:1;color:#207d68">
          <a-animation attribute="scale" from="50 50 50" to="30 30 8" direction="alternate" dur="4000" repeat="indefinite"></a-animation>
        </a-entity>
            <!--<a-entity position="-1.872 50.959 -84.143" scale="23.122 2.125 14.093" geometry="" animation="" material="color:#6f0647"></a-entity>
           <a-entity position="-0.711 41.557 -67.131" scale="23.122 2.125 14.093" geometry="" animation="" material="color:#6f0647"></a-entity>
          <a-entity position="-0.711 59.524 -95.07" scale="23.122 2.125 14.093" geometry="" animation="" material="color:#6f0647"></a-entity>   -->
               
               
               
               <!-- <a-sphere position="0 0 0" rotation="0 0 0" color="#38e4be" metalness=0.5 scale-on-mouseenter="to: 2 2 2" scale-on-mouseleave="to: 1 1 1" cursor-listener > -->
            <!--<a-animation attribute="position" to="0 2.2 -5" direction="alternate" dur="2000" repeat="indefinite"></a-animation>-->
          <!--<a-animation attribute="rotation"
                dur="10000"
                fill="forwards"
                to="360 360 360"
                repeat="indefinite">
          </a-animation>-->
        <!-- </a-sphere> -->
        <!-- <a-torus position="-1 -0.5 2" rotation="0 45 0" color="#c20752" metalness=0.5 scale-on-mouseenter="to: 1.2 1.2 1.2" scale-on-mouseleave="to: 1 1 1">
          <a-animation attribute="position" to="-3 8 -10" direction="alternate" dur="4000" repeat="indefinite"></a-animation>
        </a-torus> -->
        <!--<a-torus-knot position="0.5 6 -5" radius=3.487 radiusTubular=0.579 p=8 q=6 color="#edff0f" metalness=0.5 follow="speed: 2"  scale-on-mouseenter="to: 2 2 2" scale-on-mouseleave="to: 1 1 1">
        </a-torus-knot>-->
              <!-- <a-sphere position="0 0 0" rotation="0 0 0" color="#38e4be" metalness=0.5 scale-on-mouseenter="to: 2 2 2" scale-on-mouseleave="to: 1 1 1" cursor-listener > -->

    </a-entity>




    <a-entity id="start-menu" visible="true">

      <a-entity position="-0.186 7.075 -10.364" scale="9.715 8.691 6.896" geometry="radiusTubular:0.1;primitive:torus" material="metalness:1;color:#207d68">
        <a-animation attribute="scale" to="9 8 6" direction="alternate" dur="4000" repeat="indefinite"></a-animation>
      </a-entity>
      <a-entity id="start-button" position="0.009 7.32 -7.976" scale="2.939 3.228 1" text="align:center;color:#b9ffef;height:25;varterSpacing:3;value:Start;width:7" geometry="primitive:plane" material="color:#a49a1e"></a-entity>
      <a-box position="-0.078 7.15 -10.716" rotation="0 -88.35 0" color="#c20752" metalness="0.5" scale="4.994630333716146 5.986066272657369 1.028886577951257">
        <a-animation attribute="scale" to="5 6 6" direction="alternate" dur="4000" repeat="indefinite"></a-animation>
      </a-box>
    </a-entity>
    <!--click="nextScene()"-->
    <!-- <script type="text/javascript" src=bundle.js> </script> -->
    <script type="text/javascript" src="main.js"> 
    
     </script>

    </a-scene>
  </body>
</html>